<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>源正山鋼索五金行 - 商品管理系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-shop"></i> 源正山鋼索五金行 - 奇摩拍賣商品管理系統
            </span>
            <div class="d-flex align-items-center text-white">
                <span id="userInfo" class="me-3" style="display: none;">
                    <i class="bi bi-person-circle"></i> <span id="username"></span>
                </span>
                <span id="lastUpdate" class="me-3">尚未更新</span>

                <button id="logoutBtn" class="btn btn-outline-light" onclick="logout()" style="display: none;">
                    <i class="bi bi-box-arrow-right"></i> 登出
                </button>
            </div>
        </div>
    </nav>

    <!-- 登入界面 -->
    <div id="loginContainer" class="container-fluid mt-5">
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="card shadow">
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <i class="bi bi-shield-lock" style="font-size: 3rem; color: #0d6efd;"></i>
                            <h3 class="mt-2">系統登入</h3>
                            <p class="text-muted">請輸入帳號密碼以存取管理系統</p>
                        </div>
                        <form id="loginForm" onsubmit="handleLogin(event)">
                            <div class="mb-3">
                                <label for="loginUsername" class="form-label">帳號</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-person"></i></span>
                                    <input type="text" class="form-control" id="loginUsername" required>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="loginPassword" class="form-label">密碼</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-lock"></i></span>
                                    <input type="password" class="form-control" id="loginPassword" required>
                                </div>
                            </div>
                            <div id="loginError" class="alert alert-danger" style="display: none;"></div>
                            <button type="submit" class="btn btn-primary w-100" id="loginBtn">
                                <i class="bi bi-box-arrow-in-right"></i> 登入
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 主要內容區域 -->
    <div id="mainContainer" class="container-fluid mt-4" style="display: none;">
        <!-- 賣場選擇器 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-primary">
                    <div class="card-body py-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-shop me-2" style="font-size: 1.5rem; color: #0d6efd;"></i>
                                <h5 class="mb-0 me-3">選擇賣場：</h5>
                                <div class="btn-group" role="group">
                                    <input type="radio" class="btn-check" name="storeSelector" id="store-yuanzhengshan" value="yuanzhengshan" checked>
                                    <label class="btn btn-outline-primary" for="store-yuanzhengshan">
                                        <i class="bi bi-building"></i> 源正山鋼索五金行
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="storeSelector" id="store-youmao" value="youmao">
                                    <label class="btn btn-outline-primary" for="store-youmao">
                                        <i class="bi bi-tools"></i> 友茂
                                    </label>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">商品統計</h5>
                        <div class="row">
                            <div class="col-6">
                                <p class="mb-1">總商品數：<span id="totalProducts" class="fw-bold">0</span> 件</p>
                                <p class="mb-0 small">圖片狀態：<span id="imageStats" class="fw-bold text-success">-</span></p>
                            </div>
                            <div class="col-6">
                                <p class="mb-0">最後更新：<span id="updateTime" class="fw-bold">-</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">操作功能</h5>
                        <button class="btn btn-success me-2" onclick="exportExcel()">
                            <i class="bi bi-file-earmark-excel"></i> 匯出 Excel
                        </button>
                        <button class="btn btn-primary me-2" onclick="refreshProducts()">
                            <i class="bi bi-arrow-clockwise"></i> 重新整理
                        </button>
                        <div class="form-check form-switch d-inline-block">
                            <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                            <label class="form-check-label" for="autoRefresh">
                                自動更新 (每24小時)
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-8">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="searchInput" placeholder="搜尋商品名稱、價格或價格範圍（如：2000-5000、>1000、<500）...">
                </div>
            </div>
            <div class="col-md-4">
                <button class="btn btn-outline-secondary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#updateLogsCollapse">
                    <i class="bi bi-clock-history"></i> 更新日誌
                </button>
            </div>
        </div>

        <!-- 更新日誌折疊區域 -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="collapse" id="updateLogsCollapse">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-clock-history"></i> 更新日誌
                                </h5>
                                <button class="btn btn-sm btn-outline-danger" onclick="clearUpdateLogs()">
                                    <i class="bi bi-trash"></i> 清除日誌
                                </button>
                            </div>
                            <div id="updateLogsList" class="update-logs-container" style="max-height: 300px; overflow-y: auto;">
                                <p class="text-muted text-center">暫無更新日誌</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">商品列表</h5>
                        <div id="loadingSpinner" class="text-center py-5" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">載入中...</span>
                            </div>
                            <p class="mt-2">正在載入商品資料...</p>
                        </div>
                        <div id="errorMessage" class="alert alert-danger" style="display: none;"></div>
                        <div class="table-responsive">
                            <table class="table table-hover" id="productsTable">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 120px;">圖片</th>
                                        <th style="width: 100px;">價格</th>
                                        <th>商品名稱</th>
                                        <th style="width: 80px;">操作</th>
                                        <th class="d-none">商品編號</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTableBody">
                                    <!-- 商品資料將動態載入 -->
                                </tbody>
                            </table>
                        </div>
                        <div id="noDataMessage" class="text-center py-5" style="display: none;">
                            <i class="bi bi-inbox" style="font-size: 3rem; color: #ccc;"></i>
                            <p class="mt-2 text-muted">暫無商品資料</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 商品詳情 Modal -->
    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">商品詳情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <img id="modalImage" src="" alt="商品圖片" class="img-fluid">
                        </div>
                        <div class="col-md-6">
                            <h4 id="modalTitle"></h4>
                            <p class="text-muted">商品編號：<span id="modalId"></span></p>
                            <h3 class="text-danger">NT$ <span id="modalPrice"></span></h3>
                            <a id="modalLink" href="" target="_blank" class="btn btn-primary mt-3">
                                <i class="bi bi-box-arrow-up-right"></i> 查看原始頁面
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
